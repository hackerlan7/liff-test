<!doctype html><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>LIFF 前端</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<pre id="out">啟動中…</pre>
<script>
const LIFF_ID = '2008311996-D2KEdEnm';
const GAS_URL = 'https://script.google.com/macros/s/AKfycbyRR-UxNfnJqZ7zJ4_660dCQShVGPhCEv81xldstO5fKct5y0E-u-QbhApJ8t0yS_v7/exec';

(async () => {
  try {
    await liff.init({ liffId: LIFF_ID, withLoginOnExternalBrowser: true });
    if (!liff.isLoggedIn()) { liff.login(); return; }

    const p = await liff.getProfile();
    document.getElementById('out').textContent = 'OK\n' + JSON.stringify(p, null, 2);

    // 用圖片 Beacon 送資料（完全避開 CORS）
    const u = new URL(GAS_URL);
    u.searchParams.set('userId', p.userId);
    u.searchParams.set('name',   p.displayName);
    u.searchParams.set('action', 'test');
    u.searchParams.set('source', 'liff');

    const img = new Image();
    img.src = u.toString(); // 一載入就會觸發 GAS，GAS 會寫入試算表
  } catch (e) {
    document.getElementById('out').textContent = 'ERR\n' + (e.code || '') + '\n' + (e.message || e);
  }
})();
</script>
